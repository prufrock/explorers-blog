<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="Notes about what I discover while programming">

        <meta property="og:title" content="First Attempt At Collections | David&#039;s Explorer Blog"/>
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://dkanen.com/blog/first-attempt-at-collections"/>
        <meta property="og:description" content="Notes about what I discover while programming" />

        <title>First Attempt At Collections | David&#039;s Explorer Blog</title>

        <link rel="home" href="https://dkanen.com/">
        <link rel="icon" href="/favicon.ico">
        <link href="/blog/feed.atom" type="application/atom+xml" rel="alternate" title="David&#039;s Explorer Blog Atom Feed">

            <meta property="og:title" content="First Attempt At Collections" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://dkanen.com/blog/first-attempt-at-collections"/>
    <meta property="og:description" content="How I started using Kotlin&#039;s list and determined how to iterate over it." />

                    <!-- Matomo -->
                <script type="text/javascript">
                    var _paq = window._paq || [];
                    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
                    _paq.push(['trackPageView']);
                    _paq.push(['enableLinkTracking']);
                    (function() {
                        var u="https://matomo.dev.bushelops.com/";
                        _paq.push(['setTrackerUrl', u+'matomo.php']);
                        _paq.push(['setSiteId', '4']);
                        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
                        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
                    })();
                </script>
                <!-- End Matomo Code -->
        
        <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i,800,800i" rel="stylesheet">
        <link rel="stylesheet" href="/assets/build/css/main.css?id=595cdd7e11901d0dab8b">
    </head>

    <body class="flex flex-col justify-between min-h-screen bg-gray-100 text-gray-800 leading-normal font-sans">
        <header class="flex items-center shadow bg-white border-b h-24 py-4" role="banner">
            <div class="container flex items-center max-w-8xl mx-auto px-4 lg:px-8">
                <div class="flex items-center">
                    <a href="/" title="David&#039;s Explorer Blog home" class="inline-flex items-center">
                        <img class="h-8 md:h-10 mr-3" src="/assets/img/logo.svg" alt="David&#039;s Explorer Blog logo" />

                        <h1 class="text-lg md:text-2xl text-blue-800 font-semibold hover:text-blue-600 my-0">David&#039;s Explorer Blog</h1>
                    </a>
                </div>

                <div id="vue-search" class="flex flex-1 justify-end items-center">
                    <search></search>

                    <nav class="hidden lg:flex items-center justify-end text-lg">
    <a title="David&#039;s Explorer Blog Blog" href="/blog"
        class="ml-6 text-gray-700 hover:text-blue-600 ">
        Blog
    </a>

    <a title="David&#039;s Explorer Blog About" href="/about"
        class="ml-6 text-gray-700 hover:text-blue-600 ">
        About
    </a>

    <a title="David&#039;s Explorer Blog Contact" href="/contact"
        class="ml-6 text-gray-700 hover:text-blue-600 ">
        Contact
    </a>
</nav>

                    <button class="flex justify-center items-center bg-blue-500 border border-blue-500 h-10 px-5 rounded-full lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

                </div>
            </div>
        </header>

        <nav id="js-nav-menu" class="nav-menu hidden lg:hidden">
    <ul class="my-0">
        <li class="pl-4">
            <a
                title="David&#039;s Explorer Blog Blog"
                href="/blog"
                class="nav-menu__item hover:text-blue-500 "
            >Blog</a>
        </li>
        <li class="pl-4">
            <a
                title="David&#039;s Explorer Blog About"
                href="/about"
                class="nav-menu__item hover:text-blue-500 "
            >About</a>
        </li>
        <li class="pl-4">
            <a
                title="David&#039;s Explorer Blog Contact"
                href="/contact"
                class="nav-menu__item hover:text-blue-500 "
            >Contact</a>
        </li>
    </ul>
</nav>

        <main role="main" class="flex-auto w-full container max-w-4xl mx-auto py-16 px-6">
                        <img src="/assets/img/4-squares.svg" alt="First Attempt At Collections cover image" class="mb-2">
    
    <h1 class="leading-none mb-2">First Attempt At Collections</h1>

    <p class="text-gray-700 text-xl md:mt-0">David Kanenwisher  â€¢  February 19, 2020</p>

                        <a
                href="/blog/categories/kotlin"
                title="View posts in kotlin"
                class="inline-block bg-gray-300 hover:bg-blue-200 leading-loose tracking-wide text-gray-800 uppercase text-xs font-semibold rounded mr-4 px-3 pt-px"
            >kotlin</a>
            
    <div class="border-b border-blue-200 mb-10 pb-4" v-pre>
        <p>I need to figure out someway to satisfy my new test which checked to see if two different functions could subscribe to and receive an event from the Broadcaster. Up to this point, in Test Drive Development(TDD) fashion, my tests had allowed me to get away with sending an event to only one subscriber. I wanted to get this functionality into the Broadcaster so I added this test:</p>

<pre><code class="kotlin">    @Test
    fun `more than one Subscriber can receive a broadcast`() {
        val dispatcher = Dispatcher()

        var firstValue = ""

        dispatcher.subscribe { event -&gt; firstValue = event }

        var secondValue = ""

        dispatcher.subscribe { event -&gt; secondValue = event }

        dispatcher.broadcast("event")


        assertEquals("event", firstValue)
        assertEquals("event", secondValue)
    }
</code></pre>

<p>Currently, the Dispatcher only supports a subscriber so the first assertion failed since the first subscriber was replaced by the second. How was I going to create a list of subscribers inside of the Dispatcher? I'd seen a few things about lists in the <a href="https://www.bignerdranch.com/books/kotlin-programming-the-big-nerd-ranch-guide-2/">Big Nerd Ranch Kotlin book</a> and in the <a href="https://kotlinlang.org/docs/reference/collections-overview.html">Kotlin documentation</a>. With that and the knowledge I'd won so far I had a place to start.</p>

<p>I began by creating a <code>subscriberList</code> with the type <code>(String) -&gt; Unit</code> to match the type of the lambdas I knew I wanted to stuff in there. My previous experience with accepting a lambda as a parameter and assigning into a variable had prepared for this part. I'd seen the carrot syntax <code>&lt;Type&gt;</code> in documentation so figured that'd be the way to go. One last thing I ran into trouble with was Kotlin wouldn't let leave <code>subscriberList</code> null so I had to initialize it with <code>listOf()</code> something I saw in the Big Nerd Ranch book. I stuck all this together and got a compiling <code>subcriberList</code> declaration.</p>

<pre><code class="kotlin">    var subscriberList: List&lt;(String) -&gt; Unit&gt; = listOf()
</code></pre>

<p>Cool. Making progress. Now I needed to add a subscriber to my list. I ran into a problem pretty quick. I started updating <code>fun subscribe</code> with <code>subscriberList</code>. I put the <code>.</code> at end of the variable so I could call a method to add an element to the list. I figured I could autocomplete my way to the problem. I typed "a". Didn't see anything. I typed "add". Nothing. I switched to "app" hoping for "append". Nothing. What was going on here? Why weren't there any methods to add something to my list. A quick peak back in the Big Nerd Ranch book and I realize I need a mutable list!</p>

<pre><code class="kotlin">    var subscriberList: MutableList&lt;(String) -&gt; Unit&gt; = mutableListOf()
</code></pre>

<p>Now I have an "add" method on my list. I put that in place like so:</p>

<pre><code class="kotlin">    fun subscribe(subscriberFunction: (String) -&gt; Unit) {
        subscriber = subscriberFunction
        subscriberList.add(subscriber)
    }
</code></pre>

<p>One more thing to do. When I broadcast an event it needs to go to all of the subscribers in <code>subscriberList</code>. How do I iterate over this thing? I always liked using <code>map</code> in other languages when I want to loop over the set with a succinct lambda. I give that go here:</p>

<pre><code class="kotlin">    fun broadcast(event: String) {
        subscriber(event)
        subscriberList.map { subscriber -&gt; subscriber(event)}
    }
</code></pre>

<p>I know there are some other ways to iterate over a list so I give those a shot out of curiosity.</p>

<p>There's <code>for</code> which reminds of PHP's <a href="https://www.php.net/manual/en/control-structures.foreach.php">foreach</a>:</p>

<pre><code class="kotlin">    fun broadcast(event: String) {
        subscriber(event)
        for (subscriber in subscriberList) {
            subscriber(event)
        }
    }
</code></pre>

<p>Then there's <code>forEach</code> which is a bit more functional:</p>

<pre><code class="kotlin">        subscriberList.forEach { subscriber -&gt; subscriber(event) }
</code></pre>

<p>You know what I think I might like that more. I find that I tend to think <code>map</code> implies the list is going to be modified by the loop. The <a href="https://kotlinlang.org/docs/reference/collection-transformations.html">Kotlin documentation</a> has this to say about <code>map</code>:</p>

<blockquote>
  <p>The mapping transformation creates a collection from the results of a function on the elements of another collection.</p>
</blockquote>

<p>The word transformation there stands out to me. I'm not really transforming the collection and I also don't need the result of that transformation. <code>forEach</code> seems much more appropriate. The <strong>semantics</strong> of <code>forEach</code> fit the situation better which means I'll be able to think about the code faster when I come back to it.</p>

<p>There's one last bit of syntactical sugar I'd like to try <code>it</code>. I've see it a bunch of times in various discussions of how lambdas work on collections. I think I can use <code>it</code> here it short up this code just a smidgen:</p>

<pre><code class="kotin">    fun broadcast(event: String) {
        subscriber(event)
        subscriberList.forEach { it(event) }
    }
</code></pre>

<p>It works! With <code>it</code> I don't need to declare the element I'm work on as a <code>subscriber</code>. Instead Kotlin just assumes the variable is <code>it</code>. Kotlin knows, from the type information, that <code>subscriberList</code> holds lambdas. Therefore anything coming out of <code>subscribeList</code> can be called like a function. From that <code>it</code> can be called as a function. Pretty neat!</p>

<p>Here's how it all came together*:</p>

<pre><code class="kotlin">package com.dkanen

class Dispatcher {

    val subscriberList: MutableList&lt;(String) -&gt; Unit&gt; = mutableListOf()

    fun subscribe(subscriberFunction: (String) -&gt; Unit) {
        subscriberList.add(subscriberFunction)
    }

    fun broadcast(event: String) {
        subscriberList.map { subscriber -&gt; subscriber(event)}
    }

    fun subscribe(newSubscriber: Subscriber) {
        subscriberList.add({event -&gt; newSubscriber.receive(event)})
    }
}
</code></pre>

<p>*You may have noticed in the examples above, except the last, I still had references to the old variables like <code>subscriber</code>. It has to do with the way I keep the methods working while I am refactoring. This keeps with test driven development(TDD). I'll write about that some more a different time.</p>

<p>What ways have you found to bring collections into your projects? Let me know by dropping me a line on the <a href="/contact">contact page</a>.</p>
    </div>

    <nav class="flex justify-between text-sm md:text-base">
        <div>
                            <a href="https://dkanen.com/blog/shorthand-function-syntax" title="Older Post: Shorthand Function Syntax">
                    &LeftArrow; Shorthand Function Syntax
                </a>
                    </div>

        <div>
                            <a href="https://dkanen.com/blog/jigsaw-many-authors" title="Newer Post: Support Many Authors in Jigsaw">
                    Support Many Authors in Jigsaw &RightArrow;
                </a>
                    </div>
    </nav>
        </main>

        <footer class="bg-white text-center text-sm mt-12 py-4" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center list-none">
                <li class="md:mr-2">
                    &copy; David Kanenwisher 2020.
                </li>

                <li>
                    Built with <a href="http://jigsaw.tighten.co" title="Jigsaw by Tighten">Jigsaw</a>
                    and <a href="https://tailwindcss.com" title="Tailwind CSS, a utility-first CSS framework">Tailwind CSS</a>.
                </li>
            </ul>
        </footer>

        <script src="/assets/build/js/main.js?id=3ee46297b0ef985b07a8"></script>

        <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>
    </body>
</html>
